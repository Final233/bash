#!/bin/bash

CPUNUM=`grep "processor" /proc/cpuinfo |wc -l`
NGINX_VER="1.14.0"
NGINX_ARGS="--prefix=${NGINX_DIR} --conf-path=/etc/nginx/nginx.conf --user=nginx --group=nginx --error-log-path=/var/log/nginx/error_log --http-log-path=/var/log/nginx/access_log --pid-path=/var/run/nginx/nginx.pid --lock-path=/var/lock/nginx.lock --with-http_ssl_module --with-http_stub_status_module --with-http_gzip_static_module --with-http_flv_module --with-http_mp4_module"
NGINX_YUM=pcre-devel openssl-devel
NGINX_CONFTD="/root"
NGINX_DIR="/usr/local/nginx"
NGINX_CONF

yum install -y ${NGINX_YUM} 2> /dev/null
useradd -r nginx
#wget http://nginx.org/download/nginx-${NGINX_VER}.tar.gz
rf -rf nginx-${NGINX_VER}
tar xf nginx-${NGINX_VER}.tar.gz
cd nginx-${NGINX_VER}
./configure ${NGINX_ARGS}
make -j${cpunum}
make install
rf -rf /etc/nginx/
cp /etc/nginx/nginx.conf{,.bak}
ln -s ${NGINX_DIR}/sbin/nginx /sbin/nginx
cp ${NGINX_CONFTD}/nginx.conf /etc/nginx/nginx.conf -rf
cp ${NGINX_CONFTD}/nginx /etc/init.d/ -rf 
setenforce 0
systemctl stop firewalld
systemctl disable firewalld
/etc/init.d/nginx restart
ss -tnl|grep 80

